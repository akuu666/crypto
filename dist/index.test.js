"use strict";

var _signature = require("./starkware/signature");

var _ = require(".");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

describe('generateKey', function () {
  var mnemonic = 'range mountain blast problem vibrant void vivid doctor cluster enough melody ' + 'salt layer language laptop boat major space monkey unit glimpse pause change vibrant';
  var keyPair = (0, _.generateKey)(mnemonic);
  it('generates the expected private key', function () {
    expect(keyPair.getPrivate('hex')).toEqual('0646baa9aefb054dfa205c94b43781baa7b2ec2dfbcee64dbd9d2172283de902');
  });
});
describe('transfer', function () {
  var transfer = {
    amount: '2154549703648910716',
    nonce: 1,
    senderVaultId: '34',
    token: '0x3003a65651d3b9fb2eff934a4416db301afd112a8492aaf8d7297fc87dcd9f4',
    receiverVaultId: '21',
    receiverPublicKey: '0x5fa3383597691ea9d827a79e1a4f0f7949435ced18ca9619de8ab97e661020',
    expirationTimestamp: 438953
  };
  var privateKey = '0x07cc2767a160d4ea112b436dc6f79024db70b26b11ed7aa2cb6d7eef19ace703';
  describe('without fees', function () {
    var _signTransfer = (0, _.signTransfer)(privateKey, transfer),
        r = _signTransfer.r,
        s = _signTransfer.s;

    it('creates the correct signature', function () {
      expect(r).toEqual('0x4c21b3df630eab38d75b5538e8f635167f4f7107a885d7adf542a7525240323');
      expect(s).toEqual('0x5eacfaa59ed1b63d75241a1dbd9256d2efbe97f9451f2cf2a2af0bad5b5ab69');
    });
    it('can be verified', function () {
      var publicKey = _signature.starkEc.keyFromPrivate(privateKey.substring(2), 'hex').getPublic(true, 'hex');

      expect((0, _.verifyTransfer)("0x".concat(publicKey), transfer, {
        r: r,
        s: s
      })).toEqual(true);
    });
  });
  describe('with fees', function () {
    var transferWithFee = _objectSpread(_objectSpread({}, transfer), {}, {
      feeInfoUser: {
        sourceVaultId: '46',
        tokenId: '0x3003a65651d3b9fb2eff934a4416db301afd112a8492aaf8d7297fc87dcd9f4',
        feeLimit: '10'
      }
    });

    var _signTransfer2 = (0, _.signTransfer)(privateKey, transferWithFee),
        r = _signTransfer2.r,
        s = _signTransfer2.s;

    it('creates the correct signature', function () {
      expect(r).toEqual('0x675deb2b8eaa0f424d630fcb0896e42ccae281f5c7c030af82704954ccfafe3');
      expect(s).toEqual('0x62385cdd1b624ba2ac09b3d0edee4ad745b5402f5363217ad776abb5cec65f8');
    });
    it('can be verified', function () {
      var publicKey = _signature.starkEc.keyFromPrivate(privateKey.substring(2), 'hex').getPublic(true, 'hex');

      expect((0, _.verifyTransfer)("0x".concat(publicKey), transferWithFee, {
        r: r,
        s: s
      })).toEqual(true);
    });
  });
});
describe('limitOrder', function () {
  var limitOrder = {
    vaultIdSell: 21,
    vaultIdBuy: 27,
    amountSell: '2154686749748910716',
    amountBuy: '1470242115489520459',
    tokenSell: '0x5fa3383597691ea9d827a79e1a4f0f7989c35ced18ca9619de8ab97e661020',
    tokenBuy: '0x774961c824a3b0fb3d2965f01471c9c7734bf8dbde659e0c08dca2ef18d56a',
    nonce: 0,
    expirationTimestamp: 438953
  };
  var privateKey = '0x03c1e9550e66958296d11b60f8e8e7a7ad990d07fa65d5f7652c4a6c87d4e3cc';
  describe('without fees', function () {
    var _signLimitOrder = (0, _.signLimitOrder)(privateKey, limitOrder),
        r = _signLimitOrder.r,
        s = _signLimitOrder.s;

    it('creates the correct signature', function () {
      expect(r).toEqual('0x173fd03d8b008ee7432977ac27d1e9d1a1f6c98b1a2f05fa84a21c84c44e882');
      expect(s).toEqual('0x4b6d75385aed025aa222f28a0adc6d58db78ff17e51c3f59e259b131cd5a1cc');
    });
    it('can be verified', function () {
      var publicKey = _signature.starkEc.keyFromPrivate(privateKey.substring(2), 'hex').getPublic(true, 'hex');

      expect((0, _.verifyLimitOrder)("0x".concat(publicKey), limitOrder, {
        r: r,
        s: s
      })).toEqual(true);
    });
  });
  describe('with fee', function () {
    var limitOrderWithFee = _objectSpread(_objectSpread({}, limitOrder), {}, {
      feeInfo: {
        sourceVaultId: '46',
        tokenId: '0x3003a65651d3b9fb2eff934a4416db301afd112a8492aaf8d7297fc87dcd9f4',
        feeLimit: '10'
      }
    });

    var _signLimitOrder2 = (0, _.signLimitOrder)(privateKey, limitOrderWithFee),
        r = _signLimitOrder2.r,
        s = _signLimitOrder2.s;

    it('creates the correct signature', function () {
      expect(r).toEqual('0x461df4883210443817a91b7792e8ee02b2354b28f415a51a898447558469667');
      expect(s).toEqual('0x1b6d43fba0e3a70dcda6fb595bb7e907f39987703a781508112679332a0454');
    });
    it('can be verified', function () {
      var publicKey = _signature.starkEc.keyFromPrivate(privateKey.substring(2), 'hex').getPublic(true, 'hex');

      expect((0, _.verifyLimitOrder)("0x".concat(publicKey), limitOrderWithFee, {
        r: r,
        s: s
      })).toEqual(true);
    });
  });
});
describe('signMessage', function () {
  var message = 'random message';
  var privateKey = '0x03c1e9550e66958296d11b60f8e8e7a7ad990d07fa65d5f7652c4a6c87d4e3cc';

  var publicKey = _signature.starkEc.keyFromPrivate(privateKey.substring(2), 'hex').getPublic(true, 'hex');

  it('generates a signature that can be verified', function () {
    var signature = (0, _.signMessage)(privateKey, message);
    expect((0, _.verifyMessage)("0x".concat(publicKey), message, signature)).toBeTruthy();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50ZXN0LnRzIl0sIm5hbWVzIjpbImRlc2NyaWJlIiwibW5lbW9uaWMiLCJrZXlQYWlyIiwiaXQiLCJleHBlY3QiLCJnZXRQcml2YXRlIiwidG9FcXVhbCIsInRyYW5zZmVyIiwiYW1vdW50Iiwibm9uY2UiLCJzZW5kZXJWYXVsdElkIiwidG9rZW4iLCJyZWNlaXZlclZhdWx0SWQiLCJyZWNlaXZlclB1YmxpY0tleSIsImV4cGlyYXRpb25UaW1lc3RhbXAiLCJwcml2YXRlS2V5IiwiciIsInMiLCJwdWJsaWNLZXkiLCJzdGFya0VjIiwia2V5RnJvbVByaXZhdGUiLCJzdWJzdHJpbmciLCJnZXRQdWJsaWMiLCJ0cmFuc2ZlcldpdGhGZWUiLCJmZWVJbmZvVXNlciIsInNvdXJjZVZhdWx0SWQiLCJ0b2tlbklkIiwiZmVlTGltaXQiLCJsaW1pdE9yZGVyIiwidmF1bHRJZFNlbGwiLCJ2YXVsdElkQnV5IiwiYW1vdW50U2VsbCIsImFtb3VudEJ1eSIsInRva2VuU2VsbCIsInRva2VuQnV5IiwibGltaXRPcmRlcldpdGhGZWUiLCJmZWVJbmZvIiwibWVzc2FnZSIsInNpZ25hdHVyZSIsInRvQmVUcnV0aHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBRUE7Ozs7Ozs7O0FBV0FBLFFBQVEsQ0FBQyxhQUFELEVBQWdCLFlBQU07QUFDNUIsTUFBTUMsUUFBUSxHQUNaLGtGQUNBLHNGQUZGO0FBSUEsTUFBTUMsT0FBTyxHQUFHLG1CQUFZRCxRQUFaLENBQWhCO0FBRUFFLEVBQUFBLEVBQUUsQ0FBQyxvQ0FBRCxFQUF1QyxZQUFNO0FBQzdDQyxJQUFBQSxNQUFNLENBQUNGLE9BQU8sQ0FBQ0csVUFBUixDQUFtQixLQUFuQixDQUFELENBQU4sQ0FBa0NDLE9BQWxDLENBQ0Usa0VBREY7QUFHRCxHQUpDLENBQUY7QUFLRCxDQVpPLENBQVI7QUFjQU4sUUFBUSxDQUFDLFVBQUQsRUFBYSxZQUFNO0FBQ3pCLE1BQU1PLFFBQWtCLEdBQUc7QUFDekJDLElB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QkFDZkMsY0FEZSxDQUNBTCxVQUFVLENBQUNNLFNBQVgsQ0FBcUIsQ0FBckIsQ0FEQSxFQUN5QixLQUR6QixFQUVmQyxTQUZlLENBRUwsSUFGSyxFQUVDLEtBRkQsQ0FBbEI7O0FBSUFuQixFQUFBQSxFQUFFLENBQUMsNENBQUQsRUFBK0MsWUFBTTtBQUNyRCxRQUFNbUMsU0FBUyxHQUFHLG1CQUFZdkIsVUFBWixFQUF3QnNCLE9BQXhCLENBQWxCO0FBQ0FqQyxJQUFBQSxNQUFNLENBQUMsaUNBQW1CYyxTQUFuQixHQUFnQ21CLE9BQWhDLEVBQXlDQyxTQUF6QyxDQUFELENBQU4sQ0FBNERDLFVBQTVEO0FBQ0QsR0FIQyxDQUFGO0FBSUQsQ0FaTyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc3RhcmtFYyB9IGZyb20gJy4vc3Rhcmt3YXJlL3NpZ25hdHVyZSc7XG5cbmltcG9ydCB7XG4gIGdlbmVyYXRlS2V5LFxuICBzaWduVHJhbnNmZXIsXG4gIHNpZ25MaW1pdE9yZGVyLFxuICB2ZXJpZnlUcmFuc2ZlcixcbiAgdmVyaWZ5TGltaXRPcmRlcixcbiAgc2lnbk1lc3NhZ2UsXG4gIHZlcmlmeU1lc3NhZ2UsXG59IGZyb20gJy4nO1xuaW1wb3J0IHsgTGltaXRPcmRlciwgVHJhbnNmZXIgfSBmcm9tICcuL3R5cGVzJztcblxuZGVzY3JpYmUoJ2dlbmVyYXRlS2V5JywgKCkgPT4ge1xuICBjb25zdCBtbmVtb25pYyA9XG4gICAgJ3JhbmdlIG1vdW50YWluIGJsYXN0IHByb2JsZW0gdmlicmFudCB2b2lkIHZpdmlkIGRvY3RvciBjbHVzdGVyIGVub3VnaCBtZWxvZHkgJyArXG4gICAgJ3NhbHQgbGF5ZXIgbGFuZ3VhZ2UgbGFwdG9wIGJvYXQgbWFqb3Igc3BhY2UgbW9ua2V5IHVuaXQgZ2xpbXBzZSBwYXVzZSBjaGFuZ2UgdmlicmFudCc7XG5cbiAgY29uc3Qga2V5UGFpciA9IGdlbmVyYXRlS2V5KG1uZW1vbmljKTtcblxuICBpdCgnZ2VuZXJhdGVzIHRoZSBleHBlY3RlZCBwcml2YXRlIGtleScsICgpID0+IHtcbiAgICBleHBlY3Qoa2V5UGFpci5nZXRQcml2YXRlKCdoZXgnKSkudG9FcXVhbChcbiAgICAgICcwNjQ2YmFhOWFlZmIwNTRkZmEyMDVjOTRiNDM3ODFiYWE3YjJlYzJkZmJjZWU2NGRiZDlkMjE3MjI4M2RlOTAyJ1xuICAgICk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCd0cmFuc2ZlcicsICgpID0+IHtcbiAgY29uc3QgdHJhbnNmZXI6IFRyYW5zZmVyID0ge1xuICAgIGFtb3VudDogJzIxNTQ1NDk3MDM2NDg5MTA3MTYnLFxuICAgIG5vbmNlOiAxLFxuICAgIHNlbmRlclZhdWx0SWQ6ICczNCcsXG4gICAgdG9rZW46ICcweDMwMDNhNjU2NTFkM2I5ZmIyZWZmOTM0YTQ0MTZkYjMwMWFmZDExMmE4NDkyYWFmOGQ3Mjk3ZmM4N2RjZDlmNCcsXG4gICAgcmVjZWl2ZXJWYXVsdElkOiAnMjEnLFxuICAgIHJlY2VpdmVyUHVibGljS2V5OlxuICAgICAgJzB4NWZhMzM4MzU5NzY5MWVhOWQ4MjdhNzllMWE0ZjBmNzk0OTQzNWNlZDE4Y2E5NjE5ZGU4YWI5N2U2NjEwMjAnLFxuICAgIGV4cGlyYXRpb25UaW1lc3RhbXA6IDQzODk1MyxcbiAgfTtcblxuICBjb25zdCBwcml2YXRlS2V5ID1cbiAgICAnMHgwN2NjMjc2N2ExNjBkNGVhMTEyYjQzNmRjNmY3OTAyNGRiNzBiMjZiMTFlZDdhYTJjYjZkN2VlZjE5YWNlNzAzJztcblxuICBkZXNjcmliZSgnd2l0aG91dCBmZWVzJywgKCkgPT4ge1xuICAgIGNvbnN0IHsgciwgcyB9ID0gc2lnblRyYW5zZmVyKHByaXZhdGVLZXksIHRyYW5zZmVyKTtcblxuICAgIGl0KCdjcmVhdGVzIHRoZSBjb3JyZWN0IHNpZ25hdHVyZScsICgpID0+IHtcbiAgICAgIGV4cGVjdChyKS50b0VxdWFsKFxuICAgICAgICAnMHg0YzIxYjNkZjYzMGVhYjM4ZDc1YjU1MzhlOGY2MzUxNjdmNGY3MTA3YTg4NWQ3YWRmNTQyYTc1MjUyNDAzMjMnXG4gICAgICApO1xuICAgICAgZXhwZWN0KHMpLnRvRXF1YWwoXG4gICAgICAgICcweDVlYWNmYWE1OWVkMWI2M2Q3NTI0MWExZGJkOTI1NmQyZWZiZTk3Zjk0NTFmMmNmMmEyYWYwYmFkNWI1YWI2OSdcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnY2FuIGJlIHZlcmlmaWVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgcHVibGljS2V5ID0gc3RhcmtFY1xuICAgICAgICAua2V5RnJvbVByaXZhdGUocHJpdmF0ZUtleS5zdWJzdHJpbmcoMiksICdoZXgnKVxuICAgICAgICAuZ2V0UHVibGljKHRydWUsICdoZXgnKTtcblxuICAgICAgZXhwZWN0KHZlcmlmeVRyYW5zZmVyKGAweCR7cHVibGljS2V5fWAsIHRyYW5zZmVyLCB7IHIsIHMgfSkpLnRvRXF1YWwoXG4gICAgICAgIHRydWVcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd3aXRoIGZlZXMnLCAoKSA9PiB7XG4gICAgY29uc3QgdHJhbnNmZXJXaXRoRmVlOiBUcmFuc2ZlciA9IHtcbiAgICAgIC4uLnRyYW5zZmVyLFxuICAgICAgZmVlSW5mb1VzZXI6IHtcbiAgICAgICAgc291cmNlVmF1bHRJZDogJzQ2JyxcbiAgICAgICAgdG9rZW5JZDpcbiAgICAgICAgICAnMHgzMDAzYTY1NjUxZDNiOWZiMmVmZjkzNGE0NDE2ZGIzMDFhZmQxMTJhODQ5MmFhZjhkNzI5N2ZjODdkY2Q5ZjQnLFxuICAgICAgICBmZWVMaW1pdDogJzEwJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgICBjb25zdCB7IHIsIHMgfSA9IHNpZ25UcmFuc2Zlcihwcml2YXRlS2V5LCB0cmFuc2ZlcldpdGhGZWUpO1xuXG4gICAgaXQoJ2NyZWF0ZXMgdGhlIGNvcnJlY3Qgc2lnbmF0dXJlJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHIpLnRvRXF1YWwoXG4gICAgICAgICcweDY3NWRlYjJiOGVhYTBmNDI0ZDYzMGZjYjA4OTZlNDJjY2FlMjgxZjVjN2MwMzBhZjgyNzA0OTU0Y2NmYWZlMydcbiAgICAgICk7XG4gICAgICBleHBlY3QocykudG9FcXVhbChcbiAgICAgICAgJzB4NjIzODVjZGQxYjYyNGJhMmFjMDliM2QwZWRlZTRhZDc0NWI1NDAyZjUzNjMyMTdhZDc3NmFiYjVjZWM2NWY4J1xuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdjYW4gYmUgdmVyaWZpZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwdWJsaWNLZXkgPSBzdGFya0VjXG4gICAgICAgIC5rZXlGcm9tUHJpdmF0ZShwcml2YXRlS2V5LnN1YnN0cmluZygyKSwgJ2hleCcpXG4gICAgICAgIC5nZXRQdWJsaWModHJ1ZSwgJ2hleCcpO1xuXG4gICAgICBleHBlY3QoXG4gICAgICAgIHZlcmlmeVRyYW5zZmVyKGAweCR7cHVibGljS2V5fWAsIHRyYW5zZmVyV2l0aEZlZSwgeyByLCBzIH0pXG4gICAgICApLnRvRXF1YWwodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdsaW1pdE9yZGVyJywgKCkgPT4ge1xuICBjb25zdCBsaW1pdE9yZGVyID0ge1xuICAgIHZhdWx0SWRTZWxsOiAyMSxcbiAgICB2YXVsdElkQnV5OiAyNyxcbiAgICBhbW91bnRTZWxsOiAnMjE1NDY4Njc0OTc0ODkxMDcxNicsXG4gICAgYW1vdW50QnV5OiAnMTQ3MDI0MjExNTQ4OTUyMDQ1OScsXG4gICAgdG9rZW5TZWxsOlxuICAgICAgJzB4NWZhMzM4MzU5NzY5MWVhOWQ4MjdhNzllMWE0ZjBmNzk4OWMzNWNlZDE4Y2E5NjE5ZGU4YWI5N2U2NjEwMjAnLFxuICAgIHRva2VuQnV5OlxuICAgICAgJzB4Nzc0OTYxYzgyNGEzYjBmYjNkMjk2NWYwMTQ3MWM5Yzc3MzRiZjhkYmRlNjU5ZTBjMDhkY2EyZWYxOGQ1NmEnLFxuICAgIG5vbmNlOiAwLFxuICAgIGV4cGlyYXRpb25UaW1lc3RhbXA6IDQzODk1MyxcbiAgfTtcblxuICBjb25zdCBwcml2YXRlS2V5ID1cbiAgICAnMHgwM2MxZTk1NTBlNjY5NTgyOTZkMTFiNjBmOGU4ZTdhN2FkOTkwZDA3ZmE2NWQ1Zjc2NTJjNGE2Yzg3ZDRlM2NjJztcblxuICBkZXNjcmliZSgnd2l0aG91dCBmZWVzJywgKCkgPT4ge1xuICAgIGNvbnN0IHsgciwgcyB9ID0gc2lnbkxpbWl0T3JkZXIocHJpdmF0ZUtleSwgbGltaXRPcmRlcik7XG5cbiAgICBpdCgnY3JlYXRlcyB0aGUgY29ycmVjdCBzaWduYXR1cmUnLCAoKSA9PiB7XG4gICAgICBleHBlY3QocikudG9FcXVhbChcbiAgICAgICAgJzB4MTczZmQwM2Q4YjAwOGVlNzQzMjk3N2FjMjdkMWU5ZDFhMWY2Yzk4YjFhMmYwNWZhODRhMjFjODRjNDRlODgyJ1xuICAgICAgKTtcbiAgICAgIGV4cGVjdChzKS50b0VxdWFsKFxuICAgICAgICAnMHg0YjZkNzUzODVhZWQwMjVhYTIyMmYyOGEwYWRjNmQ1OGRiNzhmZjE3ZTUxYzNmNTllMjU5YjEzMWNkNWExY2MnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2NhbiBiZSB2ZXJpZmllZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHB1YmxpY0tleSA9IHN0YXJrRWNcbiAgICAgICAgLmtleUZyb21Qcml2YXRlKHByaXZhdGVLZXkuc3Vic3RyaW5nKDIpLCAnaGV4JylcbiAgICAgICAgLmdldFB1YmxpYyh0cnVlLCAnaGV4Jyk7XG5cbiAgICAgIGV4cGVjdCh2ZXJpZnlMaW1pdE9yZGVyKGAweCR7cHVibGljS2V5fWAsIGxpbWl0T3JkZXIsIHsgciwgcyB9KSkudG9FcXVhbChcbiAgICAgICAgdHJ1ZVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3dpdGggZmVlJywgKCkgPT4ge1xuICAgIGNvbnN0IGxpbWl0T3JkZXJXaXRoRmVlOiBMaW1pdE9yZGVyID0ge1xuICAgICAgLi4ubGltaXRPcmRlcixcbiAgICAgIGZlZUluZm86IHtcbiAgICAgICAgc291cmNlVmF1bHRJZDogJzQ2JyxcbiAgICAgICAgdG9rZW5JZDpcbiAgICAgICAgICAnMHgzMDAzYTY1NjUxZDNiOWZiMmVmZjkzNGE0NDE2ZGIzMDFhZmQxMTJhODQ5MmFhZjhkNzI5N2ZjODdkY2Q5ZjQnLFxuICAgICAgICBmZWVMaW1pdDogJzEwJyxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IHsgciwgcyB9ID0gc2lnbkxpbWl0T3JkZXIocHJpdmF0ZUtleSwgbGltaXRPcmRlcldpdGhGZWUpO1xuXG4gICAgaXQoJ2NyZWF0ZXMgdGhlIGNvcnJlY3Qgc2lnbmF0dXJlJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHIpLnRvRXF1YWwoXG4gICAgICAgICcweDQ2MWRmNDg4MzIxMDQ0MzgxN2E5MWI3NzkyZThlZTAyYjIzNTRiMjhmNDE1YTUxYTg5ODQ0NzU1ODQ2OTY2NydcbiAgICAgICk7XG4gICAgICBleHBlY3QocykudG9FcXVhbChcbiAgICAgICAgJzB4MWI2ZDQzZmJhMGUzYTcwZGNkYTZmYjU5NWJiN2U5MDdmMzk5ODc3MDNhNzgxNTA4MTEyNjc5MzMyYTA0NTQnXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2NhbiBiZSB2ZXJpZmllZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHB1YmxpY0tleSA9IHN0YXJrRWNcbiAgICAgICAgLmtleUZyb21Qcml2YXRlKHByaXZhdGVLZXkuc3Vic3RyaW5nKDIpLCAnaGV4JylcbiAgICAgICAgLmdldFB1YmxpYyh0cnVlLCAnaGV4Jyk7XG5cbiAgICAgIGV4cGVjdChcbiAgICAgICAgdmVyaWZ5TGltaXRPcmRlcihgMHgke3B1YmxpY0tleX1gLCBsaW1pdE9yZGVyV2l0aEZlZSwgeyByLCBzIH0pXG4gICAgICApLnRvRXF1YWwodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdzaWduTWVzc2FnZScsICgpID0+IHtcbiAgY29uc3QgbWVzc2FnZSA9ICdyYW5kb20gbWVzc2FnZSc7XG4gIGNvbnN0IHByaXZhdGVLZXkgPVxuICAgICcweDAzYzFlOTU1MGU2Njk1ODI5NmQxMWI2MGY4ZThlN2E3YWQ5OTBkMDdmYTY1ZDVmNzY1MmM0YTZjODdkNGUzY2MnO1xuICBjb25zdCBwdWJsaWNLZXkgPSBzdGFya0VjXG4gICAgLmtleUZyb21Qcml2YXRlKHByaXZhdGVLZXkuc3Vic3RyaW5nKDIpLCAnaGV4JylcbiAgICAuZ2V0UHVibGljKHRydWUsICdoZXgnKTtcblxuICBpdCgnZ2VuZXJhdGVzIGEgc2lnbmF0dXJlIHRoYXQgY2FuIGJlIHZlcmlmaWVkJywgKCkgPT4ge1xuICAgIGNvbnN0IHNpZ25hdHVyZSA9IHNpZ25NZXNzYWdlKHByaXZhdGVLZXksIG1lc3NhZ2UpO1xuICAgIGV4cGVjdCh2ZXJpZnlNZXNzYWdlKGAweCR7cHVibGljS2V5fWAsIG1lc3NhZ2UsIHNpZ25hdHVyZSkpLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG59KTtcbiJdfQ==